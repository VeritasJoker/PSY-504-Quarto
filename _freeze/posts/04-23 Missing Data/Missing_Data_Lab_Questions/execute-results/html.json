{
  "hash": "e33e342f6a5ef6c98d6b1c73b51775b0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab: Missing Data\"\nsubtitle: \"Princeton University\"\ndate: \"2025-04-23\"\nauthor: \"KW\"\ncategories: [code, analysis]\nformat:\n  html:\n    self-contained: false\n    anchor-sections: true\n    code-tools: true\n    code-fold: true\n    fig-width: 8\n    fig-height: 4\n    code-block-bg: \"#f1f3f5\"\n    code-block-border-left: \"#31BAE9\"\n    mainfont: Source Sans Pro\n    theme: journal\n    toc: true\n    toc-depth: 3\n    toc-location: left\n    captions: true\n    cap-location: margin\n    table-captions: true\n    tbl-cap-location: margin\n    reference-location: margin\n  pdf:\n    pdf-engine: lualatex\n    toc: false\n    number-sections: true\n    number-depth: 2\n    top-level-division: section\n    reference-location: document\n    listings: false\n    header-includes:\n      \\usepackage{marginnote, here, relsize, needspace, setspace}\n      \\def\\it{\\emph}\nexecute:\n  freeze: auto\n  echo: true\n  message: false\n  warning: false\n  fig-align: center\n  fig-width: 12\n  fig-height: 8\n  editor_options: \n  chunk_output_type: inline\n  code-overflow: wrap\n  html:\n    code-fold: true\n    code-tools: true\neditor: visual\n---\n\n---\n\nMissing data is a common problem and dealing with it appropriately is extremely important. Ignoring the missing data points or filling them incorrectly may cause the models to work in unexpected ways and cause the predictions and inferences to be biased.\n\nLe'ts consider built-in dataset 'airquality' in R as a sample dataset.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the airquality dataset\ndata(\"airquality\")\n```\n:::\n\n#### Question 1:\n\n(a) Examine this dataset for missing values. While there are many ways to do this, the skim function from the library 'skimr' is elegant;\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(skimr)\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(mice)\nskim(airquality)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |           |\n|:------------------------|:----------|\n|Name                     |airquality |\n|Number of rows           |153        |\n|Number of columns        |6          |\n|_______________________  |           |\n|Column type frequency:   |           |\n|numeric                  |6          |\n|________________________ |           |\n|Group variables          |None       |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|    sd|   p0|    p25|   p50|    p75|  p100|hist  |\n|:-------------|---------:|-------------:|------:|-----:|----:|------:|-----:|------:|-----:|:-----|\n|Ozone         |        37|          0.76|  42.13| 32.99|  1.0|  18.00|  31.5|  63.25| 168.0|▇▃▂▁▁ |\n|Solar.R       |         7|          0.95| 185.93| 90.06|  7.0| 115.75| 205.0| 258.75| 334.0|▅▃▅▇▅ |\n|Wind          |         0|          1.00|   9.96|  3.52|  1.7|   7.40|   9.7|  11.50|  20.7|▂▇▇▃▁ |\n|Temp          |         0|          1.00|  77.88|  9.47| 56.0|  72.00|  79.0|  85.00|  97.0|▂▃▇▇▃ |\n|Month         |         0|          1.00|   6.99|  1.42|  5.0|   6.00|   7.0|   8.00|   9.0|▇▇▇▇▇ |\n|Day           |         0|          1.00|  15.80|  8.86|  1.0|   8.00|  16.0|  23.00|  31.0|▇▇▇▇▆ |\n\n\n:::\n:::\n\n\n(b) use the nanair package to visualize missing values\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(naniar)\nvis_miss(airquality)\n```\n\n::: {.cell-output-display}\n![](Missing_Data_Lab_Questions_files/figure-html/unnamed-chunk-3-1.png){width=768}\n:::\n:::\n\n(c) even though it's hard to confirm based on visualizations alone, what do your visualizations lead you to believe about the missing data being MCAR, MAR, or MNAR?\n\nI would say it is probably not MCAR, since most of the missing data is for Ozone and Solar.R. There are also lots of clusters in missing data. I would guess it's probably MAR, but could also be MNAR.\n\n(d) Carry out Little's statistical test to evaluate MCAR and report results.\n\n::: {.cell}\n\n```{.r .cell-code}\nmcar_test(airquality) %>% kable()\n```\n\n::: {.cell-output-display}\n\n\n| statistic| df|   p.value| missing.patterns|\n|---------:|--:|---------:|----------------:|\n|  35.10613| 14| 0.0014178|                4|\n\n\n:::\n:::\n\nOur p-value is < 0.05 and the test is significant, so it is not MCAR.\n\n(e) Creating a binary indicator for missingness allows you to test whether the presence of missing data is related to observed data.\n\n    -   For instance, you can create a dummy variable: 1 = Missing; 0 = Observed.\n    -   Next you can conduct a chi-square test or t-test:\n        -   Chi-square: Compare proportions of missingness ***across groups***.\n        -   T-test: Compare means of (other) observed variables with missingness indicators.\n\n::: {.cell}\n\n```{.r .cell-code}\nair = airquality %>% #can also use case_when #if missing 1 else \n  mutate(Ozone_miss = ifelse(is.na(Ozone), 1, 0),\n         Solar_miss = ifelse(is.na(Solar.R), 1, 0))\n\nt.test(Wind ~ Ozone_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Wind by Ozone_miss\nt = -0.60911, df = 63.646, p-value = 0.5446\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -1.6893132  0.8999377\nsample estimates:\nmean in group 0 mean in group 1 \n       9.862069       10.256757 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(Temp ~ Ozone_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Temp by Ozone_miss\nt = -0.026831, df = 60.447, p-value = 0.9787\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -3.643306  3.546847\nsample estimates:\nmean in group 0 mean in group 1 \n       77.87069        77.91892 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(Month ~ Ozone_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Month by Ozone_miss\nt = 4.0092, df = 92.075, p-value = 0.0001236\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n 0.4273815 1.2664675\nsample estimates:\nmean in group 0 mean in group 1 \n       7.198276        6.351351 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(Day ~ Ozone_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Day by Ozone_miss\nt = -0.64426, df = 57.826, p-value = 0.522\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -4.576080  2.347749\nsample estimates:\nmean in group 0 mean in group 1 \n       15.53448        16.64865 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(Wind ~ Solar_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Wind by Solar_miss\nt = 0.65629, df = 6.4571, p-value = 0.5343\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -2.674488  4.681338\nsample estimates:\nmean in group 0 mean in group 1 \n       10.00342         9.00000 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(Temp ~ Solar_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Temp by Solar_miss\nt = 0.98706, df = 6.2689, p-value = 0.3602\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -7.436381 17.669258\nsample estimates:\nmean in group 0 mean in group 1 \n       78.11644        73.00000 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(Month ~ Solar_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Month by Solar_miss\nt = 1.2018, df = 6.4489, p-value = 0.2717\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -0.7432664  2.2266323\nsample estimates:\nmean in group 0 mean in group 1 \n       7.027397        6.285714 \n```\n\n\n:::\n\n```{.r .cell-code}\nt.test(Day ~ Solar_miss, data = air, var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Day by Solar_miss\nt = 2.1941, df = 6.6803, p-value = 0.06612\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -0.6161166 14.5769776\nsample estimates:\nmean in group 0 mean in group 1 \n      16.123288        9.142857 \n```\n\n\n:::\n:::\n\nOzone missing data is related to month. The solar missing data is not related to other variables.\n\n\n#### Question 2:\n\nCreate **new and appropriately named datasets** that are based on airquality for each of the following ways of fixing the dataset:\n\n```         \n  - (a) \"listwise deletion\" or \"complete case analysis\" --- where entire records from the analysis are removed if they are missing any data point in one or more variables \n  \n  - (b) Imputation with mean --- involves filling in the missing values with the mean of the available values in the same variable.\n  \n  - (c) Imputation with regression (use mice package)\n  \n  - (d) Imputation with stochastic regression (use mice package)\n\n  - (e) Imputation with multiple induction (use mice package, 5 imputations, and Predictive mean matching method)\n```\n\n::: {.cell}\n\n```{.r .cell-code}\n# (a)\nair_a = airquality %>% drop_na()\n\n# (b)\nair_b = airquality %>%\n  mutate(\n    Ozone = if_else(is.na(Ozone), mean(Ozone, na.rm = TRUE), Ozone),\n    Solar.R = if_else(is.na(Solar.R), mean(Solar.R, na.rm = TRUE), Solar.R)\n  )\n\n# (c)\nair_c = complete(mice(airquality, method=\"norm.predict\", m=1, maxit=1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n iter imp variable\n  1   1  Ozone  Solar.R\n```\n\n\n:::\n\n```{.r .cell-code}\n# (d)\nair_d = complete(mice(airquality, m=1, method=\"norm.nob\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n iter imp variable\n  1   1  Ozone  Solar.R\n  2   1  Ozone  Solar.R\n  3   1  Ozone  Solar.R\n  4   1  Ozone  Solar.R\n  5   1  Ozone  Solar.R\n```\n\n\n:::\n\n```{.r .cell-code}\n# (e)\nm=5\nimp = mice(airquality, m = m, seed = 24415, method=\"pmm\", print = FALSE)\nair_e = complete(imp, action=\"long\")\n```\n:::\n\n#### Question 3:\n\nCompare the eventual distribution from these datasets on the variable 'Ozone'against the orgiinal. Below is a template that considers only 2 datasets but please consider all the datasets you generated within a single plot\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(airquality, aes(x=Ozone, fill=\"Original\")) +\n  geom_density(alpha=0.5) +\n  geom_density(data=air_a, aes(x=Ozone, fill=\"Listwise Deletion\"), alpha=0.5) +\n  geom_density(data=air_b, aes(x=Ozone, fill=\"Imputation with Mean\"), alpha=0.5) +\n  geom_density(data=air_c, aes(x=Ozone, fill=\"Imputation with Regression\"), alpha=0.5) +\n  geom_density(data=air_d, aes(x=Ozone, fill=\"Imputation with Stochastic Regression\"), alpha=0.5) +\n  geom_density(data=air_e, aes(x=Ozone, fill=\"Imputation with Multiple Induction\"), alpha=0.5) +\n  labs(title=\"Density Plot of Ozone: Original vs. Five Missing Data Methods\")\n```\n\n::: {.cell-output-display}\n![](Missing_Data_Lab_Questions_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\nWhat do you observe?\n\nList-wise deletion mostly keeps the original density shape.\n\nImputation with mean is clearly the worst, as it seems to decrease variability.\n\nImputation with regression and stochastic regression does ok, but has more spread out density than the original.\n\nImputation with multiple induction seems to keep the original density shape while keeping all the data.\n\n\n#### Of course, each dataset you produced will lead to different modeling results, but we won't go into that in today's lab.\n",
    "supporting": [
      "Missing_Data_Lab_Questions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}