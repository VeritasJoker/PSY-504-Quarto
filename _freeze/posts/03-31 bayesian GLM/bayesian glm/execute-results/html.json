{
  "hash": "426a73935c888bbbc361ea5e8f3dd7fc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Bayesian GLM\"\nsubtitle: \"   \"\nauthor: \"Ken Wang\"\ndate: '2025-03-31'\nfooter: \"PSY 504\"\nformat: \n  revealjs:\n    theme: white\n    css: slide-style.css\n    multiplex: true\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\n    auto-stretch: false\n    fontsize: \"20pt\"\nwebr:\n  packages: [\"tidyverse\", \"easystats\", \"broom\", \"kableExtra\", \"interactions\", \"emmeans\", \"lme4\",\"lmertest\",  \"ggeffects\"]\nfilters:\n  - webr\nexecute:\n  freeze: auto\n  echo: true\n  message: false\n  warning: false\n  fig-align: center\n  fig-width: 16\n  fig-height: 12\n  editor_options: \n  chunk_output_type: inline\n  code-overflow: wrap\n  html:\n    code-fold: true\n    code-tools: true\n---\n\n\n## Bayesian GLM\n\n-   Bayesian Inference\n-   Generalized Linear Models (GLMs)\n\n\n![](images/pp3.png){.pp width=\"50%\" fig-align=\"center\"}\n\n# Background\n\n## Bayes Rule\n\n::: columns\n::: {.column width=\"50%\"}\n![](images/bayes.gif){fig-align=\"center\"}\n:::\n\n::: {.column width=\"50%\"}\n<!-- ![](images/bayes_side.png){fig-align=\"center\"} -->\n\n$p(\\theta|y)\\propto p(y|\\theta)p(\\theta)$\n\n::: {.smalltxt}\n- $p(\\theta)$: prior distributions of the parameters\n:::\n\n::: {.smallertxt}\n  - Prior beliefs or the prior knowledge on the parameter distributions, based on the existing knowledge or the results of previous studies\n:::\n\n::: {.smalltxt}\n- $p(y|\\theta)$: probability distribution of the data given the parameters\n:::\n\n::: {.smallertxt}\n  - The likelihood function\n:::\n\n::: {.smalltxt}\n- $p(\\theta|y)$: posterior distributions of the parameters\n:::\n\n::: {.smallertxt}\n  - Proportional to the prior distributions of the parameter times the likelihood function\n:::  \n\n:::\n:::\n\n## Frequentist vs Bayesian Inference\n\n::: columns\n::: {.column width=\"50%\"}\n\nFrequentist\n\n::: {.addpad}\n- Objective probability:\n:::\n\n::: {.smalltxt}\n  - The limit of the relative frequency of an event occuring in a large number of trials\n  - Probabilities are inherent properties of the phenomena under consideration.\n:::\n\n:::\n::: {.column width=\"50%\"}\n\nBayesian\n\n::: {.addpad}\n- Subjective probability:\n:::\n\n::: {.smalltxt}\n- Reflects an individual's degree of belief in the occurrence of an event\n- Updated as new evidence becomes available\n:::\n\n:::\n\n:::\n\n## Frequentist vs Bayesian Inference\n\n::: columns\n::: {.column width=\"50%\"}\n\nFrequentist\n\n::: {.addpad}\n- Parameter Estimation:\n:::\n\n::: {.smalltxt}\n  - Parameters are unknown and fixed\n  - Distinguish parameters from random variables\n  - Use sample data to estimate parameters with a certain level of confidence\n:::\n\n:::\n::: {.column width=\"50%\"}\n\nBayesian\n\n::: {.addpad}\n- Parameter Estimation:\n:::\n\n::: {.smalltxt}\n- Parameters are also random variables with probability distributions\n- A fixed set of parameters implies a distribution over the data, $p(y|\\theta)$\n- A fixed set of data implies a distribution over the parameters, $p(\\theta|y)$\n- Incorporates information from both the prior distribution and the likelihood function\n:::\n\n:::\n\n:::\n\n## Frequentist vs Bayesian Inference\n\n::: columns\n::: {.column width=\"50%\"}\n\nFrequentist\n\n::: {.addpad}\n- Hypothesis Testing:\n:::\n\n::: {.smalltxt}\n  - Formulating null and alternative hypotheses\n  - Collecting sample data\n  - Making decisions based on the probability of observing the data under the assumption that the null hypothesis is true\n  - p-values: probability of obtaining the observed data or more extreme data if the null is true\n:::\n\n:::\n::: {.column width=\"50%\"}\n\nBayesian\n\n::: {.addpad}\n- Bayesian Inference:\n:::\n\n::: {.smalltxt}\n- Define a prior distribution based on existing knowledge\n- Collect sample data\n- Develop a likelihood function that describes the probability of observing the collected data given different values of the parameter\n- Use Bayes' Theorem to update the prior distribution and obtain the posterior distribution\n- Make inference about the parameter based on the posterior distribution\n:::\n\n:::\n\n:::\n\n## Frequentist vs Bayesian Inference\n\n::: columns\n::: {.column width=\"50%\"}\n\nFrequentist\n\n::: {.addpad}\n- p-values:\n:::\n\n::: {.smalltxt}\n- the probability of obtaining the observed data or more extreme data under the assumption that the null hypothesis is true\n:::\n\n::: {.addpad}\n- Confidence intervals:\n:::\n\n::: {.smalltxt}\n  - contain the true parameter value with a certain frequency in repeated sampling\n:::\n\n:::\n::: {.column width=\"50%\"}\n\nBayesian\n\n::: {.addpad}\n- posterior probabilities:\n:::\n\n::: {.smalltxt}\n- the probability of hypotheses given the data\n:::\n\n::: {.addpad}\n- Credible intervals:\n:::\n\n::: {.smalltxt}\n- contain the true parameter value with a certain level of credibility based on the posterior distribution\n:::\n\n:::\n\n:::\n\n## Why Bayesian?\n\n::: columns\n::: {.column width=\"50%\"}\n\nFrequentist\n\n::: {.addpad}\n- Limitations:\n:::\n\n::: {.smalltxt}\n  - Subjectivity in the null hypothesis choice\n  - Confidence intervals can be misinterpreted\n  - Fixed Parameter Assumption\n:::\n\n:::\n::: {.column width=\"50%\"}\n\nBayesian\n\n::: {.addpad}\n- Advantages:\n:::\n\n::: {.smalltxt}\n- Incorporating prior information\n- Uncertainty quantification\n:::\n:::\n\n:::\n\n## Markov Chain Monte Carlo (MCMC)\n\n::: {.medtxt}\n- Developed in the 1940s by physicists at Los Alamos\n\n- An algorithm used to draw samples from a probability distribution\n\n- Monte Carlo: Use random samples over a distribution to estimate solutions or perform simulations\n\n- Markov Chain: A sequence of random variables where the next state depends only on the current state\n\n- General procedure:\n:::\n\n::: {.smalltxt}\n  - Starts with an initial guess (or \"seed\") and iteratively propose new values based on the current value and the target distribution\n  - These proposed values are accepted or rejected based on a probability that depends on the target distribution\n  - Over many iterations, the sequence of samples forms a distribution that approximates the target posterior distribution\n:::  \n\n## Generalized Linear Models (GLMs)\n\n::: {.medtxt}\n- Extends ordinary linear regression models\n\n- A link function that connects the linear predictor and the expected value or mean of $y$.\n\n- Examples\n:::\n\n::: {.smalltxt}\n- Logistic regression\n- Ordinal regression\n- Multinomial regression\n- Poisson regression\n- Negative binomial regression\n\n:::\n\n## Bayesian GLM\n\n-   Bayesian Inference\n-   Generalized Linear Models (GLMs)\n\n\n![](images/pp3.png){.pp width=\"50%\" fig-align=\"center\"}\n\n\n# Implementation in R\n\n## Bayesian Logistic Regression\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load data\ndata <- read.csv(\"logistic.csv\")\nhead(data) %>% kable()\n```\n\n::: {.cell-output-display}\n\n\n| age|sex    | sei10|polviews         | mass_trans_spend_right|\n|---:|:------|-----:|:----------------|----------------------:|\n|  47|Male   |  87.9|Moderate         |                      0|\n|  61|Male   |  38.3|Liberal          |                      0|\n|  43|Female |  21.8|Moderate         |                      0|\n|  55|Female |  39.7|Slightly liberal |                      0|\n|  53|Female |  44.6|Slightly liberal |                      1|\n|  50|Male   |  80.7|Slightly liberal |                      0|\n\n\n:::\n:::\n\n\n\n## Fitting Logistic\n\n\n\n\n\n\nFrequentist Logistic Regression\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_model_freq = glm(\n  mass_trans_spend_right ~ 1 + age + sex + sei10,\n  family=binomial,\n  data=data\n)\n```\n:::\n\n\nBayesian Logistic Regression\n\n::: {.cell}\n\n```{.r .cell-code}\ninvisible({capture.output({\n\nlog_model_bay = brm(\n  mass_trans_spend_right ~ 1 + age + sex + sei10,\n  family=bernoulli(link=\"logit\"),\n  data=data,\n  warmup=500,\n  iter=2000,\n  cores=2,\n  chains=2,\n  seed=123\n)\n\n})})\n```\n:::\n\n## Evaluating Logistic\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_model(log_model_freq)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">mass_trans_spend_right</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Odds Ratios</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">(Intercept)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.28</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.74&nbsp;&ndash;&nbsp;3.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">age</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99&nbsp;&ndash;&nbsp;1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>0.007</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">sex [Male]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.77</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.66&nbsp;&ndash;&nbsp;0.91</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">sei10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99&nbsp;&ndash;&nbsp;1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">2590</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> Tjur</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.014</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_model(log_model_bay)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"2\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">mass_trans_spend_right</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Odds Ratios</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI (95%)</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Intercept</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.28</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.74&nbsp;&ndash;&nbsp;2.98</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">age</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99&nbsp;&ndash;&nbsp;1.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">sex: Male</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.77</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.66&nbsp;&ndash;&nbsp;0.91</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">sei10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99&nbsp;&ndash;&nbsp;1.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"2\">2590</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> Bayes</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.015</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n:::\n:::\n\n## Marginal Effects\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\n# predicted probability\npp_sex <- ggemmeans(log_model_freq, terms = c(\"sex\"))\nggplot(pp_sex, aes(x = x, y = predicted, color = x)) +\n  geom_point(size = 2) +\n  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +\n  labs(title = \"Effect of Sex on Satisfaction with Mass Transportation\",\n       x = \"Sex\", y = \"Predicted Probability\",\n       color = \"Sex\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-8-1.png){width=1536}\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\n# marginal effects\nce = conditional_effects(log_model_bay, effects=\"sex\")\nplot(ce, ask = FALSE)\n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-9-1.png){width=1536}\n:::\n:::\n\n\n:::\n:::\n\n## Marginal Effects\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\n# predicted probability\npp_ses <- ggemmeans(log_model_freq, terms = \"sei10 [all]\")\nggplot(pp_ses, aes(x = x, y = predicted)) +\n  geom_line(color = \"#2c7fb8\", size = 1) + \n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), fill = \"#2c7fb8\", alpha = 0.2) +  # Add a confidence interval band\n  labs(title = \"Effect of SES on Satisfaction with Mass Transportation\",\n       x = \"Socioeconomic Status\", y = \"Predicted Probability\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")  \n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-10-1.png){width=1536}\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\n# marginal effects\nce = conditional_effects(log_model_bay, effects=\"sei10\")\nplot(ce, ask = FALSE)\n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-11-1.png){width=1536}\n:::\n:::\n\n:::\n:::\n\n\n## Plotting Parameters\n\nParameter distribution\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_plot(log_model_bay, type=\"intervals\")\n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-12-1.png){width=1536}\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_plot(log_model_bay, type=\"hist\", bins=30)\n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-13-1.png){width=1536}\n:::\n\n```{.r .cell-code}\n# mcmc_plot(log_model_bay, type=\"dens\")\n```\n:::\n\n:::\n:::\n\n## Plotting Parameters\n\n::: columns\n::: {.column width=\"50%\"}\nTrace\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_plot(log_model_bay, type=\"trace\")\n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-14-1.png){width=1536}\n:::\n:::\n\n:::\n:::\n\n## Plotting Parameters\n\n::: columns\n::: {.column width=\"50%\"}\nTwo parameters\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_plot(log_model_bay, variable=c(\"b_Intercept\", \"b_age\"), type=\"scatter\")\n```\n\n::: {.cell-output-display}\n![](bayesian-glm_files/figure-revealjs/unnamed-chunk-15-1.png){width=1536}\n:::\n:::\n\n:::\n:::\n\n## Other GLMs\n\nLots of Bayesian GLMs, all in one package!\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel = brm(\n  y ~ 1 + x1 + x2 + x3 + (1+x4|x3), # multilevel\n  family=bernoulli(link=\"logit\"), # logistic\n  family=cumulative(link=\"logit\"), # ordinal\n  family=categorical(link=\"logit\"), # multinomial\n  family=poisson(link=\"log\"), # poisson\n  family=negbinomial(link=\"log\") # negative binomial\n  family=zero_inflated_poisson(link=\"log\") # zero-inflated poisson\n  family=zero_inflated_negbinomial(link=\"log\") # zero-inflated negbinom\n  data=data,\n  warmup=500,\n  iter=2000,\n  cores=2,\n  chains=2,\n  seed=123\n)\n```\n:::\n",
    "supporting": [
      "bayesian-glm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}