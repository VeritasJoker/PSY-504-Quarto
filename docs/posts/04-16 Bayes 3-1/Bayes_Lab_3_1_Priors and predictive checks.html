<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="KW">
<meta name="dcterms.date" content="2025-04-16">

<title>PSY-504-Quarto - PSY 504: Bayes Lab 3, Priors and Predictive Checks April 16th, 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">PSY-504-Quarto</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">PSY 504: Bayes Lab 3, Priors and Predictive Checks April 16th, 2025</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Princeton University</p>
                                <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>KW </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 16, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup-packages-and-data" id="toc-setup-packages-and-data" class="nav-link active" data-scroll-target="#setup-packages-and-data">Setup: Packages and data</a></li>
  <li><a href="#intercept-only-model" id="toc-intercept-only-model" class="nav-link" data-scroll-target="#intercept-only-model">Intercept-only model</a>
  <ul class="collapse">
  <li><a href="#visualize-possible-prior-distributions." id="toc-visualize-possible-prior-distributions." class="nav-link" data-scroll-target="#visualize-possible-prior-distributions.">Visualize possible prior distributions.</a></li>
  <li><a href="#prior-predictive-checks-by-hand." id="toc-prior-predictive-checks-by-hand." class="nav-link" data-scroll-target="#prior-predictive-checks-by-hand.">Prior-predictive checks (by hand).</a></li>
  <li><a href="#fit-the-model-that-you-prefer" id="toc-fit-the-model-that-you-prefer" class="nav-link" data-scroll-target="#fit-the-model-that-you-prefer">Fit the model that you prefer</a></li>
  </ul></li>
  <li><a href="#prior-predictive-checks-by-sample_prior-only" id="toc-prior-predictive-checks-by-sample_prior-only" class="nav-link" data-scroll-target="#prior-predictive-checks-by-sample_prior-only">Prior-predictive checks (by <code>sample_prior = "only"</code>)</a></li>
  <li><a href="#univariable-predictor-model" id="toc-univariable-predictor-model" class="nav-link" data-scroll-target="#univariable-predictor-model">Univariable predictor model</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information">Session information</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Bayes_Lab_3_1_Priors-and-predictive-checks.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><br>
During the first Bayes Lab you considered exploratory data analysis, compared default brms with lm(), and extracted posteriors after fitting models. You summarized posterior distributions and also generated a distribution of predictions using these posterior draws.<br>
<br>
During the second Bayes lab, you looked at the different types of distributions that are relevant for Bayesian analysis, including priors.</p>
<p>During today’s lab, you will go into prior predictive checks and some HMC diagnostics. While we look at the simple linear modeling case, this workflow is relevant for all Bayesian models.</p>
<section id="setup-packages-and-data" class="level2">
<h2 class="anchored" data-anchor-id="setup-packages-and-data">Setup: Packages and data</h2>
<p>Load the primary packages.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(truncnorm)  # if needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This time we’ll be taking data from the <strong>moderndive</strong> package. We want the <code>evals</code> data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(evals, <span class="at">package =</span> <span class="st">"moderndive"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>evals</code> data were originally in the paper by Hamermesh and Parker (2005; <a href="https://doi.org/10.1016/j.econedurev.2004.07.013)." class="uri">https://doi.org/10.1016/j.econedurev.2004.07.013).</a> You can learn more about the data like this:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>?moderndive<span class="sc">::</span>evals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You can learn even more information about the data from <a href="https://www.openintro.org/data/index.php?data=evals." class="uri">https://www.openintro.org/data/index.php?data=evals.</a></p>
<p>Anyway, we need to subset the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>evals94 <span class="ot">&lt;-</span> evals <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(prof_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(evals94)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 94
Columns: 14
$ ID           &lt;int&gt; 1, 5, 8, 10, 18, 24, 31, 36, 43, 50, 60, 63, 68, 75, 79, …
$ prof_ID      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
$ score        &lt;dbl&gt; 4.7, 4.6, 4.1, 4.5, 4.8, 4.4, 4.4, 3.4, 4.8, 4.0, 3.6, 4.…
$ age          &lt;int&gt; 36, 59, 51, 40, 31, 62, 33, 51, 33, 47, 35, 37, 42, 49, 3…
$ bty_avg      &lt;dbl&gt; 5.000, 3.000, 3.333, 3.167, 7.333, 5.500, 4.167, 4.000, 4…
$ gender       &lt;fct&gt; female, male, male, female, female, male, female, female,…
$ ethnicity    &lt;fct&gt; minority, not minority, not minority, not minority, not m…
$ language     &lt;fct&gt; english, english, english, english, english, english, eng…
$ rank         &lt;fct&gt; tenure track, tenured, tenured, tenured, tenure track, te…
$ pic_outfit   &lt;fct&gt; not formal, not formal, not formal, not formal, not forma…
$ pic_color    &lt;fct&gt; color, color, color, color, color, color, color, color, c…
$ cls_did_eval &lt;int&gt; 24, 17, 55, 40, 42, 182, 33, 25, 48, 16, 18, 30, 28, 30, …
$ cls_students &lt;int&gt; 43, 20, 55, 46, 48, 282, 41, 41, 60, 19, 25, 34, 40, 36, …
$ cls_level    &lt;fct&gt; upper, upper, upper, upper, upper, upper, upper, upper, u…</code></pre>
</div>
</div>
</section>
<section id="intercept-only-model" class="level2">
<h2 class="anchored" data-anchor-id="intercept-only-model">Intercept-only model</h2>
<p>Let’s start by fitting an intercept-only model</p>
<p><span class="math display">\[
\begin{align}
\text{bty\_avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \beta_0 \\
\beta_0 &amp; \sim \text{???} \\
\sigma &amp; \sim \text{???},
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\beta_0\)</span> is the same as the unconditional population mean, and the population standard deviation is <span class="math inline">\(\sigma\)</span>. Our next task will be choosing our priors.</p>
<section id="question-1-why-have-we-left-some-of-the-specification-above-unfilled-with-questions-marks-at-this-point" class="level4">
<h4 class="anchored" data-anchor-id="question-1-why-have-we-left-some-of-the-specification-above-unfilled-with-questions-marks-at-this-point">Question 1: Why have we left some of the specification above unfilled / with questions marks at this point?</h4>
<p>Because here <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\sigma\)</span> are disributions, and we don’t have a chosen prior distribution for them just yet.</p>
</section>
<section id="visualize-possible-prior-distributions." class="level3">
<h3 class="anchored" data-anchor-id="visualize-possible-prior-distributions.">Visualize possible prior distributions.</h3>
<p>In this exercise, we’ll choose the priors together. Let’s start with prior on <span class="math inline">\(\beta_0\)</span>. Below are a few candidate distributions visualized with <strong>ggdist</strong> and friends.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>)),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">8</span>, <span class="dv">2</span>)),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">2</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj, <span class="at">y =</span> prior)) <span class="sc">+</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mean_qi, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"The red lines mark the lower and upper boundaries."</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The red lines in the figures (shown at x=1 and x=10) represent the lower and upper boundaries for the beauty ratings scale used in the study. With the simple intercept model, setting a prior on the intercept parameter is the same as setting a prior on the expected mean in observation space.</p>
<p>Now let’s visualize a few potential priors for <span class="math inline">\(\sigma\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>)), </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lb =</span> <span class="dv">0</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">2</span>, <span class="fl">0.3</span>), <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj, <span class="at">y =</span> prior)) <span class="sc">+</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mean_qi, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p)(sigma))) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<section id="question-2-given-that-sigma-refers-to-the-standard-deviation-are-these-three-priors-theoretically-possible-if-yes-give-an-example-of-a-theoretically-impossible-prior-for-sigma." class="level4">
<h4 class="anchored" data-anchor-id="question-2-given-that-sigma-refers-to-the-standard-deviation-are-these-three-priors-theoretically-possible-if-yes-give-an-example-of-a-theoretically-impossible-prior-for-sigma.">Question 2: Given that <span class="math inline">\(\sigma\)</span> refers to the standard deviation, are these three priors theoretically possible? If yes, give an example of a theoretically impossible prior for <span class="math inline">\(\sigma\)</span>.</h4>
<p>Yes, they should all be theoretically possible, since we only need <span class="math inline">\(\sigma\)</span> to be bigger than 0, and all three priors satisfy that.</p>
<p>A theoretically impossible prior would be a normal distribution with mean 0 and standard deviation 1, but not having a left bound and cutoff at 0.</p>
</section>
</section>
<section id="prior-predictive-checks-by-hand." class="level3">
<h3 class="anchored" data-anchor-id="prior-predictive-checks-by-hand.">Prior-predictive checks (by hand).</h3>
<p>Note: It’s possible we’ll need the <code>truncnorm::rtruncnorm()</code> function in this section. Once we have candidate priors for both <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\sigma\)</span>, we can simulate values from those priors and plot the implied distributions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the simulation reproducible?</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate values from the priors</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>       <span class="co"># choose the hyperparameter values with the class</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rexp</span>(<span class="at">n =</span> n, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> beta0, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The simulated values constitute predictions that are made using our prior beliefs (a prior is set for beta0 and another for sigma) When you check if these predictions (prior predictive) make sense or not, it is called the prior predictive check. The point of the prior predictive check is to iterate on specifying the priors until the prior predictive is sensible/satisfactory.</p>
<p>(Again, the red boundaries denote that the only possible bty_avg values are between 1 and 10.)</p>
<section id="question-3-can-explain-what-the-section-of-the-previous-command-before-ggplot-is-doing" class="level4">
<h4 class="anchored" data-anchor-id="question-3-can-explain-what-the-section-of-the-previous-command-before-ggplot-is-doing">Question 3: Can Explain what the section of the previous command, before ggplot is doing?</h4>
<p>The code first sets the number of draws to 50. Then creates a tibble with 50 rows, where each row is a simulated <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma\)</span>. Then we attach a column <code>bty_avg</code> that ranges from –2 to 13 with step 0.025 for every draw, making the tibble 30,050 rows. Then for each <code>bty_avg</code> value, we calculate the density of the normal distribution given each <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma\)</span>. Then we plot the 50 density plots for the 50 distributions.</p>
</section>
<section id="question-4-the-prior-predictive-above-is-for-one-combination-of-our-candidate-priors.-why-dont-you-also-try-the-beta_0-prior-centered-at-8-along-with-the-sigma-prior-centered-at-2-what-do-you-observe-among-these-two-which-would-you-pick-and-why-optional-try-others-too-if-youd-like" class="level4">
<h4 class="anchored" data-anchor-id="question-4-the-prior-predictive-above-is-for-one-combination-of-our-candidate-priors.-why-dont-you-also-try-the-beta_0-prior-centered-at-8-along-with-the-sigma-prior-centered-at-2-what-do-you-observe-among-these-two-which-would-you-pick-and-why-optional-try-others-too-if-youd-like">Question 4: The prior predictive above is for one combination of our candidate priors. Why don’t you also try the <span class="math inline">\(\beta_0\)</span> prior centered at 8, along with the <span class="math inline">\(\sigma\)</span> prior centered at 2? What do you observe? Among these two , which would you pick? And why? (Optional: try others too if you’d like)</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the simulation reproducible?</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate values from the priors</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>       <span class="co"># choose the hyperparameter values with the class</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> beta0, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truncnorm)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the simulation reproducible?</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate values from the priors</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>       <span class="co"># choose the hyperparameter values with the class</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rtruncnorm</span>(<span class="at">n =</span> n, <span class="at">a =</span> <span class="dv">0</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> beta0, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The <span class="math inline">\(\beta_0\)</span> prior centered at 8 with the <span class="math inline">\(\sigma\)</span> prior centered at 2 has a much wider density plot. I don’t like how it’s centered around 8 though. I also tried a third one, where the <span class="math inline">\(\beta_0\)</span> prior is centered at 5.5 with an sd of 2, and the <span class="math inline">\(\sigma\)</span> prior is a truncated normal distribution of mean 0 and sd 1. I think I would prefer the first one, since all the density plots are within the lower and upper boundaries.</p>
</section>
</section>
<section id="fit-the-model-that-you-prefer" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-model-that-you-prefer">Fit the model that you prefer</h3>
<p>We should practice writing out our model equation with our priors of choice:</p>
<p><span class="math display">\[
\begin{align}
\text{bty\_avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \beta_0 \\
\beta_0 &amp; \sim \text{Normal}(5.5,\,1) \\
\sigma &amp; \sim \text{Exponential}(1).
\end{align}
\]</span></p>
<p>Let’s fit a model with our priors of choice.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit9.b <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> evals94,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  bty_avg <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure we're settled on our priors </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we don't need to use these; they're placeholders</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the model summary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit9.b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: bty_avg ~ 1 
   Data: evals94 (Number of observations: 94) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     4.62      0.17     4.30     4.95 1.00     3636     2922

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     1.60      0.12     1.39     1.84 1.00     3769     2947

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Now we might do a posterior predictive check to see how well our model describes the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit9.b, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"posterior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit9.b, <span class="at">ndraws =</span> <span class="dv">8</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"hist"</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>)  <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"posterior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Our simple Gaussian model doesn’t do a great job respecting the lower and upper boundaries, but this is about as good as it gets when you’re in Gaussian land. On the whole, the model did a pretty okay reproducing the gross features of the distribution of the sample data.</p>
<section id="question-5-to-ensure-youve-understood-things-well-can-you-write-below-about-the-difference-between-the-prior-predictive-check-and-the-posterior-predictive-check-how-do-they-differ-in-their-objectives" class="level4">
<h4 class="anchored" data-anchor-id="question-5-to-ensure-youve-understood-things-well-can-you-write-below-about-the-difference-between-the-prior-predictive-check-and-the-posterior-predictive-check-how-do-they-differ-in-their-objectives">Question 5: To ensure you’ve understood things well, can you write below about the difference between the prior predictive check and the posterior predictive check? How do they differ in their objectives?</h4>
<p>The prior predictive check draws from the prior distributions. It is used to evaluate prior plausibility and can help detect unrealistic priors or unreasonable model behavior early in the modeling process.</p>
<p>The posterior predictive checks draws from the posterior distributions. It is used to check for model fit, as it takes into account both the data and the prior.</p>
</section>
</section>
</section>
<section id="prior-predictive-checks-by-sample_prior-only" class="level2">
<h2 class="anchored" data-anchor-id="prior-predictive-checks-by-sample_prior-only">Prior-predictive checks (by <code>sample_prior = "only"</code>)</h2>
<p>We can also sample from the prior predictive distribution from <code>brm()</code> itself. To do so, we use the <code>sample_prior</code> argument, which has the following options:</p>
<ul>
<li><code>"no"</code>, which is the default, and does not sample from the prior;</li>
<li><code>"yes",</code>, which will sample from both the prior and the posterior; and</li>
<li><code>"only"</code>, which will only sample from the prior.</li>
</ul>
<p>Let’s set <code>sample_prior = "only"</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check to see if we want to use other priors</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>fit10.b <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> evals94,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  bty_avg <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here's the magic</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">"only"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we can set our seed, too!</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Did you notice how we used the <code>seed</code> argument? This makes the results reproducible.</p>
<p>Now the <code>summary()</code> function only returns summaries for the priors, NOT the posterior.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit10.b)  <span class="co"># this summarizes the prior</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: bty_avg ~ 1 
   Data: evals94 (Number of observations: 94) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     5.49      1.00     3.49     7.45 1.00     2076     2255

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.98      0.97     0.03     3.50 1.00     2029     1418

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>The <code>as_draws_df()</code> function also returns draws from the prior.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit10.b) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A draws_df: 6 iterations, 1 chains, and 5 variables
  b_Intercept sigma Intercept lprior lp__
1         4.2  1.08       4.2   -2.8 -2.7
2         6.1  0.99       6.1   -2.1 -2.1
3         5.8  0.99       5.8   -2.0 -2.0
4         6.2  0.46       6.2   -1.6 -2.4
5         6.2  0.49       6.2   -1.7 -2.4
6         6.0  0.23       6.0   -1.3 -2.8
# ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
</div>
<p>Here’s how we might use that <code>as_draws_df()</code> output to make a similar plot to the one we made before.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the results reproducible?</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit10.b) <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># notice we're defining the mean by b_Intercept</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> b_Intercept, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>             <span class="co"># notice we're grouping by .draw</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> .draw)) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>We can also use functions like <code>pp_check()</code> to compare the prior to the sample data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit10.b, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit10.b, <span class="at">ndraws =</span> <span class="dv">8</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"hist"</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="univariable-predictor-model" class="level2">
<h2 class="anchored" data-anchor-id="univariable-predictor-model">Univariable predictor model</h2>
<p>Now we’ll add <code>gender</code> as the sole predictor in the model,</p>
<p><span class="math display">\[
\begin{align}
\text{bty_avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \beta_0 + \beta_1 \text{gender}_i \\
\beta_0 &amp; \sim \text{???} \\
\beta_1 &amp; \sim \text{???} \\
\sigma &amp; \sim \text{???}.
\end{align}
\]</span></p>
<p>Let’s try these same set of <span class="math inline">\(\beta_0\)</span> priors</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change as needed</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>)),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">7</span>, <span class="fl">0.5</span>)),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">2</span>))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj, <span class="at">y =</span> prior)) <span class="sc">+</span> </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mean_qi, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"The red lines mark the lower and upper bondaries."</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Now we update our by-hand prior predictive simulation to accomodate <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>       <span class="co"># notice our new line</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta1 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rexp</span>(<span class="at">n =</span> n, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we have a new expand_grid() line</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure everyone understands this coding scheme</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">gendermale =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># notice the updated mean formula</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> gendermale, </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span> and<span class="sc">~</span><span class="fu">italic</span>(p)(beta[<span class="dv">1</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma))) <span class="sc">+</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> gendermale, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Before we fit the model, let’s practice the <code>sample_prior = "only"</code> approach.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check to see if we want to use other priors</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>fit11.b <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> evals94,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># notice the 0 + Intercept syntax</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  bty_avg <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> gender,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> gendermale) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here's the magic</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">"only"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">2</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the prior summary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit11.b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: bty_avg ~ 0 + Intercept + gender 
   Data: evals94 (Number of observations: 94) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept      5.49      0.98     3.58     7.40 1.00     3315     2688
gendermale    -0.02      1.00    -1.93     1.90 1.00     3354     2634

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     1.00      1.00     0.03     3.55 1.00     2186     1435

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Compare the prior with the data with <code>pp_check()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit11.b, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"dens_overlay_grouped"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">"gender"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit11.b, <span class="at">ndraws =</span> <span class="dv">5</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"freqpoly_grouped"</span>, <span class="at">group =</span> <span class="st">"gender"</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>There isn’t a great grouped histogram option for <code>pp_check()</code>, so we experimented with <code>type = "freqpoly_grouped"</code> instead.</p>
<p>If we wanted, we could also use the <code>predict()</code> function to simulate <code>bty_avg</code> values from the priors.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># walk through this slowly</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit11.b,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ndraws =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:5, 1:94] 4.1 7.4 2.61 6.32 6.22 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : NULL</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># customize the predictor grid, as desired</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">gender =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>), <span class="at">each =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this will make it easier to connect the nd data to the predict() output</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit11.b,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> nd,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">ndraws =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draw =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>draw) <span class="sc">%&gt;%</span> </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">str_remove</span>(name, <span class="st">"X"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nd, <span class="at">by =</span> <span class="st">"row"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">boundary =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(draw <span class="sc">~</span> gender, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Once we’ve settled on our priors, we should once again practice writing out the full model equation:</p>
<p><span class="math display">\[
\begin{align}
\text{bty_avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \beta_0 + \beta_1 \text{gender}_i \\
\beta_0 &amp; \sim \text{Normal}(5.5,1) \\
\beta_1 &amp; \sim \text{Normal}(0,1) \\
\sigma &amp; \sim \text{Exponential}(1).
\end{align}
\]</span></p>
<p>Okay, let’s fit the real model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check to see if we want to use other priors</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>fit12.b <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> evals94,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  bty_avg <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> gender,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept) <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> gendermale) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, you can set your seed for your posteriors, too</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this makes the results reproducible</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">3</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the model summary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit12.b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: bty_avg ~ 0 + Intercept + gender 
   Data: evals94 (Number of observations: 94) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept      4.93      0.24     4.46     5.39 1.00     2151     1978
gendermale    -0.55      0.31    -1.18     0.06 1.00     2219     2156

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     1.58      0.12     1.38     1.83 1.00     2709     2289

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>How does the posterior-predictive check look?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit12.b, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"dens_overlay_grouped"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">"gender"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"posterior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit12.b, <span class="at">ndraws =</span> <span class="dv">5</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"freqpoly_grouped"</span>, <span class="at">group =</span> <span class="st">"gender"</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayes_Lab_3_1_Priors-and-predictive-checks_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<section id="question-6-does-the-posterior-predictive-check-look-satsifactory-to-you" class="level4">
<h4 class="anchored" data-anchor-id="question-6-does-the-posterior-predictive-check-look-satsifactory-to-you">Question 6: Does the posterior predictive check look satsifactory to you?</h4>
<p>The posterior predictive check look alright. The spread of <span class="math inline">\(y\)</span> for both male and female is quite decently captured by the <span class="math inline">\(y_{rep}\)</span> draws. However, the model still does not respect the upper and lower boundaries sometimes.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For more on prior predictive checks, see McElreath (from Chapter 4), and Solomon Kurz’s brms/tidverse implementations as well.</p>
<p>For a comprehensive guide to set priors for a given situation, look at reccomendations made by the Stan team https://github.com/stan-dev/stan/wiki/prior-choice-recommendations</p>
<p>They generally recommend against uniform priors on <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma\)</span> parameters. This is based on a general principle that you should not use a prior that places an artificial boundary on a parameter.</p>
<p>E.g. <span class="math inline">\(\sigma\)</span> parameters have natural lower boundaries at zero, but they don’t have upper boundaries. Thus, a uniform prior adds an unnatural upper boundary. A better prior would be something that is weakly informative</p>
</div>
</div>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Hamermesh, D. S., &amp; Parker, A. (2005). Beauty in the classroom: Instructors’ pulchritude and putative pedagogical productivity. <em>Economics of Education Review, 24</em>(4), 369-376. https://doi.org/10.1016/j.econedurev.2004.07.013</p>
<p>Kurz, A. S. (2023). <em>Statistical Rethinking with brms, ggplot2, and the tidyverse: Second Edition</em> (version 0.4.0). https://bookdown.org/content/4857/</p>
<p>McElreath, R. (2020). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em> (Second Edition). CRC Press. https://xcelab.net/rm/statistical-rethinking/</p>
</section>
<section id="session-information" class="level2">
<h2 class="anchored" data-anchor-id="session-information">Session information</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14)
Platform: x86_64-apple-darwin20
Running under: macOS 15.4.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.4-x86_64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/New_York
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] truncnorm_1.0-9 tidybayes_3.0.7 brms_2.22.0     Rcpp_1.0.14    
 [5] lubridate_1.9.4 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4    
 [9] purrr_1.0.4     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   
[13] ggplot2_3.5.2   tidyverse_2.0.0

loaded via a namespace (and not attached):
 [1] svUnit_1.0.6         tidyselect_1.2.1     farver_2.1.2        
 [4] loo_2.8.0            fastmap_1.2.0        tensorA_0.36.2.1    
 [7] digest_0.6.37        estimability_1.5.1   timechange_0.3.0    
[10] lifecycle_1.0.4      StanHeaders_2.32.10  processx_3.8.5      
[13] magrittr_2.0.3       posterior_1.6.0      compiler_4.4.1      
[16] rlang_1.1.4          tools_4.4.1          yaml_2.3.10         
[19] knitr_1.49           labeling_0.4.3       bridgesampling_1.1-2
[22] htmlwidgets_1.6.4    pkgbuild_1.4.6       curl_6.2.0          
[25] plyr_1.8.9           abind_1.4-8          withr_3.0.2         
[28] numDeriv_2016.8-1.1  grid_4.4.1           stats4_4.4.1        
[31] xtable_1.8-4         colorspace_2.1-1     inline_0.3.21       
[34] emmeans_1.10.7       scales_1.3.0         cli_3.6.3           
[37] mvtnorm_1.3-3        rmarkdown_2.28       generics_0.1.3      
[40] RcppParallel_5.1.10  rstudioapi_0.17.1    reshape2_1.4.4      
[43] tzdb_0.4.0           rstan_2.32.6         bayesplot_1.11.1    
[46] parallel_4.4.1       matrixStats_1.5.0    vctrs_0.6.5         
[49] V8_6.0.3             Matrix_1.7-0         jsonlite_1.8.8      
[52] callr_3.7.6          hms_1.1.3            arrayhelpers_1.1-0  
[55] ggdist_3.3.2         glue_1.8.0           codetools_0.2-20    
[58] ps_1.9.0             distributional_0.5.0 stringi_1.8.4       
[61] gtable_0.3.6         QuickJSR_1.5.2       munsell_0.5.1       
[64] pillar_1.10.1        htmltools_0.5.8.1    Brobdingnag_1.2-9   
[67] R6_2.5.1             evaluate_1.0.3       lattice_0.22-6      
[70] backports_1.5.0      renv_1.0.7           rstantools_2.4.0    
[73] coda_0.19-4.1        gridExtra_2.3        nlme_3.1-164        
[76] checkmate_2.3.2      xfun_0.51            pkgconfig_2.0.3     </code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "PSY 504: Bayes Lab 3, Priors and Predictive Checks April 16th, 2025"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Princeton University"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-04-16"</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "KW"</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [code, analysis]</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">    self-contained: false</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">    anchor-sections: true</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 8</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 4</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-bg: "#f1f3f5"</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-border-left: "#31BAE9"</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: Source Sans Pro</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: journal</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co">    captions: true</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="co">    cap-location: margin</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co">    table-captions: true</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co">    tbl-cap-location: margin</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="co">    reference-location: margin</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="co">    pdf-engine: lualatex</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: false</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 2</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co">    top-level-division: section</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="co">    reference-location: document</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co">    listings: false</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="co">    header-includes:</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="co">      \usepackage{marginnote, here, relsize, needspace, setspace}</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="co">      \def\it{\emph}</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: auto</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-align: center</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-width: 12</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-height: 8</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="co">  editor_options: </span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: inline</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="co">  code-overflow: wrap</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>During the first Bayes Lab you considered exploratory data analysis, compared default brms with lm(), and extracted posteriors after fitting models. You summarized posterior distributions and also generated a distribution of predictions using these posterior draws.\</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>During the second Bayes lab, you looked at the different types of distributions that are relevant for Bayesian analysis, including priors.</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>During today's lab, you will go into prior predictive checks and some HMC diagnostics. While we look at the simple linear modeling case, this workflow is relevant for all Bayesian models.</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup: Packages and data</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>Load the primary packages.</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = FALSE, message = FALSE}</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="in">library(brms)</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidybayes)</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="in"># library(truncnorm)  # if needed</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>This time we'll be taking data from the **moderndive** package. We want the <span class="in">`evals`</span> data set.</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(evals, <span class="at">package =</span> <span class="st">"moderndive"</span>)</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>The <span class="in">`evals`</span> data were originally in the paper by Hamermesh and Parker (2005; <span class="ot">&lt;https://doi.org/10.1016/j.econedurev.2004.07.013).&gt;</span> You can learn more about the data like this:</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>?moderndive<span class="sc">::</span>evals</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>You can learn even more information about the data from <span class="ot">&lt;https://www.openintro.org/data/index.php?data=evals.&gt;</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>Anyway, we need to subset the data.</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a>evals94 <span class="ot">&lt;-</span> evals <span class="sc">%&gt;%</span> </span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(prof_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(evals94)</span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## Intercept-only model</span></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a>Let's start by fitting an intercept-only model</span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a>\text{bty<span class="sc">\_</span>avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) <span class="sc">\\</span></span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \beta_0 <span class="sc">\\</span></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a>\beta_0 &amp; \sim \text{???} <span class="sc">\\</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a>\sigma &amp; \sim \text{???},</span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>\end{align} </span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a>where $\beta_0$ is the same as the unconditional population mean, and the population standard deviation is $\sigma$. Our next task will be choosing our priors.</span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question 1: Why have we left some of the specification above unfilled / with questions marks at this point?</span></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a>Because here $\beta_0$ and $\sigma$ are disributions, and we don't have a chosen prior distribution for them just yet.</span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize possible prior distributions.</span></span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a>In this exercise, we'll choose the priors together. Let's start with prior on $\beta_0$. Below are a few candidate distributions visualized with **ggdist** and friends.</span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>)),</span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">8</span>, <span class="dv">2</span>)),</span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">2</span>))</span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj, <span class="at">y =</span> prior)) <span class="sc">+</span> </span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mean_qi, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"The red lines mark the lower and upper boundaries."</span>,</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])),</span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a>The red lines in the figures (shown at x=1 and x=10) represent the lower and upper boundaries for the beauty ratings scale used in the study. With the simple intercept model, setting a prior on the intercept parameter is the same as setting a prior on the expected mean in observation space.</span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a>Now let's visualize a few potential priors for $\sigma$.</span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>)), </span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lb =</span> <span class="dv">0</span>), </span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">2</span>, <span class="fl">0.3</span>), <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj, <span class="at">y =</span> prior)) <span class="sc">+</span> </span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mean_qi, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p)(sigma))) <span class="sc">+</span></span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question 2: Given that $\sigma$ refers to the standard deviation, are these three priors theoretically possible? If yes, give an example of a theoretically impossible prior for $\sigma$.</span></span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a>Yes, they should all be theoretically possible, since we only need $\sigma$ to be bigger than 0, and all three priors satisfy that.</span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a>A theoretically impossible prior would be a normal distribution with mean 0 and standard deviation 1, but not having a left bound and cutoff at 0.</span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prior-predictive checks (by hand).</span></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>Note: It's possible we'll need the <span class="in">`truncnorm::rtruncnorm()`</span> function in this section. Once we have candidate priors for both $\beta_0$ and $\sigma$, we can simulate values from those priors and plot the implied distributions.</span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the simulation reproducible?</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate values from the priors</span></span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a>       <span class="co"># choose the hyperparameter values with the class</span></span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rexp</span>(<span class="at">n =</span> n, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> beta0, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a>The simulated values constitute predictions that are made using our prior beliefs (a prior is set for beta0 and another for sigma) When you check if these predictions (prior predictive) make sense or not, it is called the prior predictive check. The point of the prior predictive check is to iterate on specifying the priors until the prior predictive is sensible/satisfactory.</span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a>(Again, the red boundaries denote that the only possible bty_avg values are between 1 and 10.)</span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question 3: Can Explain what the section of the previous command, before ggplot is doing?</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a>The code first sets the number of draws to 50. Then creates a tibble with 50 rows, where each row is a simulated $\beta$ and $\sigma$. Then we attach a column <span class="in">`bty_avg`</span> that ranges from –2 to 13 with step 0.025 for every draw, making the tibble 30,050 rows. Then for each <span class="in">`bty_avg`</span> value, we calculate the density of the normal distribution given each $\beta$ and $\sigma$. Then we plot the 50 density plots for the 50 distributions.</span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question 4: The prior predictive above is for one combination of our candidate priors. Why don't you also try the $\beta_0$ prior centered at 8, along with the $\sigma$ prior centered at 2? What do you observe? Among these two , which would you pick? And why? (Optional: try others too if you'd like)</span></span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the simulation reproducible?</span></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate values from the priors</span></span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a>       <span class="co"># choose the hyperparameter values with the class</span></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> beta0, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truncnorm)</span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the simulation reproducible?</span></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate values from the priors</span></span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a>       <span class="co"># choose the hyperparameter values with the class</span></span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rtruncnorm</span>(<span class="at">n =</span> n, <span class="at">a =</span> <span class="dv">0</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-255"><a href="#cb41-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> beta0, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-256"><a href="#cb41-256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a>The $\beta_0$ prior centered at 8 with the $\sigma$ prior centered at 2 has a much wider density plot. I don't like how it's centered around 8 though. I also tried a third one, where the $\beta_0$ prior is centered at 5.5 with an sd of 2, and the $\sigma$ prior is a truncated normal distribution of mean 0 and sd 1. I think I would prefer the first one, since all the density plots are within the lower and upper boundaries.</span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit the model that you prefer</span></span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a>We should practice writing out our model equation with our priors of choice:</span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a>\text{bty<span class="sc">\_</span>avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) <span class="sc">\\</span></span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \beta_0 <span class="sc">\\</span></span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a>\beta_0 &amp; \sim \text{Normal}(5.5,\,1) <span class="sc">\\</span></span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a>\sigma &amp; \sim \text{Exponential}(1).</span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a>Let's fit a model with our priors of choice.</span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit9.b, results = "hide"}</span></span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a><span class="in">fit9.b = brm(</span></span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a><span class="in">  data = evals94,</span></span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a><span class="in">  family = gaussian,</span></span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a><span class="in">  bty_avg ~ 1,</span></span>
<span id="cb41-289"><a href="#cb41-289" aria-hidden="true" tabindex="-1"></a><span class="in">  # make sure we're settled on our priors </span></span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a><span class="in">  # we don't need to use these; they're placeholders</span></span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = prior(normal(5.5, 1), class = Intercept) +</span></span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a><span class="in">    prior(exponential(1), class = sigma)</span></span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a>Check the model summary.</span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit9.b)</span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a>Now we might do a posterior predictive check to see how well our model describes the data.</span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit9.b, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"posterior predictive check"</span>)</span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit9.b, <span class="at">ndraws =</span> <span class="dv">8</span>,</span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"hist"</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb41-317"><a href="#cb41-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>)  <span class="sc">+</span></span>
<span id="cb41-318"><a href="#cb41-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"posterior predictive check"</span>)</span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a>Our simple Gaussian model doesn't do a great job respecting the lower and upper boundaries, but this is about as good as it gets when you're in Gaussian land. On the whole, the model did a pretty okay reproducing the gross features of the distribution of the sample data.</span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question 5: To ensure you've understood things well, can you write below about the difference between the prior predictive check and the posterior predictive check? How do they differ in their objectives?</span></span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a>The prior predictive check draws from the prior distributions. It is used to evaluate prior plausibility and can help detect unrealistic priors or unreasonable model behavior early in the modeling process.</span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a>The posterior predictive checks draws from the posterior distributions. It is used to check for model fit, as it takes into account both the data and the prior.</span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prior-predictive checks (by `sample_prior = "only"`)</span></span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a>We can also sample from the prior predictive distribution from <span class="in">`brm()`</span> itself. To do so, we use the <span class="in">`sample_prior`</span> argument, which has the following options:</span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`"no"`</span>, which is the default, and does not sample from the prior;</span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`"yes",`</span>, which will sample from both the prior and the posterior; and</span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`"only"`</span>, which will only sample from the prior.</span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a>Let's set <span class="in">`sample_prior = "only"`</span>.</span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-340"><a href="#cb41-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit10.b, results = "hide"}</span></span>
<span id="cb41-341"><a href="#cb41-341" aria-hidden="true" tabindex="-1"></a><span class="in"># check to see if we want to use other priors</span></span>
<span id="cb41-342"><a href="#cb41-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a><span class="in">fit10.b = brm(</span></span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a><span class="in">  data = evals94,</span></span>
<span id="cb41-345"><a href="#cb41-345" aria-hidden="true" tabindex="-1"></a><span class="in">  family = gaussian,</span></span>
<span id="cb41-346"><a href="#cb41-346" aria-hidden="true" tabindex="-1"></a><span class="in">  bty_avg ~ 1,</span></span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = prior(normal(5.5, 1), class = Intercept) +</span></span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a><span class="in">    prior(exponential(1), class = sigma),</span></span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a><span class="in">  # here's the magic</span></span>
<span id="cb41-350"><a href="#cb41-350" aria-hidden="true" tabindex="-1"></a><span class="in">  sample_prior = "only",</span></span>
<span id="cb41-351"><a href="#cb41-351" aria-hidden="true" tabindex="-1"></a><span class="in">  # we can set our seed, too!</span></span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 1</span></span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a>Did you notice how we used the <span class="in">`seed`</span> argument? This makes the results reproducible.</span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a>Now the <span class="in">`summary()`</span> function only returns summaries for the priors, NOT the posterior.</span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-362"><a href="#cb41-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit10.b)  <span class="co"># this summarizes the prior</span></span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a>The <span class="in">`as_draws_df()`</span> function also returns draws from the prior.</span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit10.b) <span class="sc">%&gt;%</span> </span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-374"><a href="#cb41-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-375"><a href="#cb41-375" aria-hidden="true" tabindex="-1"></a>Here's how we might use that <span class="in">`as_draws_df()`</span> output to make a similar plot to the one we made before.</span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a><span class="co"># how many distributions do you want?</span></span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a><span class="co"># do you want to make the results reproducible?</span></span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1)</span></span>
<span id="cb41-385"><a href="#cb41-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-386"><a href="#cb41-386" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit10.b) <span class="sc">%&gt;%</span> </span>
<span id="cb41-387"><a href="#cb41-387" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-388"><a href="#cb41-388" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset</span></span>
<span id="cb41-389"><a href="#cb41-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a>  <span class="co"># notice we're defining the mean by b_Intercept</span></span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, <span class="at">mean =</span> b_Intercept, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-394"><a href="#cb41-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, </span>
<span id="cb41-395"><a href="#cb41-395" aria-hidden="true" tabindex="-1"></a>             <span class="co"># notice we're grouping by .draw</span></span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> .draw)) <span class="sc">+</span></span>
<span id="cb41-397"><a href="#cb41-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-398"><a href="#cb41-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb41-400"><a href="#cb41-400" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-401"><a href="#cb41-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma)))</span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a>We can also use functions like <span class="in">`pp_check()`</span> to compare the prior to the sample data.</span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-409"><a href="#cb41-409" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb41-410"><a href="#cb41-410" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit10.b, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb41-411"><a href="#cb41-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb41-412"><a href="#cb41-412" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-413"><a href="#cb41-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span>
<span id="cb41-414"><a href="#cb41-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-415"><a href="#cb41-415" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb41-416"><a href="#cb41-416" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit10.b, <span class="at">ndraws =</span> <span class="dv">8</span>,</span>
<span id="cb41-417"><a href="#cb41-417" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"hist"</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb41-418"><a href="#cb41-418" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb41-419"><a href="#cb41-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-420"><a href="#cb41-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span>
<span id="cb41-421"><a href="#cb41-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-422"><a href="#cb41-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-423"><a href="#cb41-423" aria-hidden="true" tabindex="-1"></a><span class="fu">## Univariable predictor model</span></span>
<span id="cb41-424"><a href="#cb41-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-425"><a href="#cb41-425" aria-hidden="true" tabindex="-1"></a>Now we'll add <span class="in">`gender`</span> as the sole predictor in the model,</span>
<span id="cb41-426"><a href="#cb41-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-427"><a href="#cb41-427" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-428"><a href="#cb41-428" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb41-429"><a href="#cb41-429" aria-hidden="true" tabindex="-1"></a>\text{bty_avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) <span class="sc">\\</span></span>
<span id="cb41-430"><a href="#cb41-430" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \beta_0 + \beta_1 \text{gender}_i <span class="sc">\\</span></span>
<span id="cb41-431"><a href="#cb41-431" aria-hidden="true" tabindex="-1"></a>\beta_0 &amp; \sim \text{???} <span class="sc">\\</span></span>
<span id="cb41-432"><a href="#cb41-432" aria-hidden="true" tabindex="-1"></a>\beta_1 &amp; \sim \text{???} <span class="sc">\\</span></span>
<span id="cb41-433"><a href="#cb41-433" aria-hidden="true" tabindex="-1"></a>\sigma &amp; \sim \text{???}.</span>
<span id="cb41-434"><a href="#cb41-434" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb41-435"><a href="#cb41-435" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-436"><a href="#cb41-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-437"><a href="#cb41-437" aria-hidden="true" tabindex="-1"></a>Let's try these same set of $\beta_0$ priors</span>
<span id="cb41-438"><a href="#cb41-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-441"><a href="#cb41-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-442"><a href="#cb41-442" aria-hidden="true" tabindex="-1"></a><span class="co"># change as needed</span></span>
<span id="cb41-443"><a href="#cb41-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-444"><a href="#cb41-444" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb41-445"><a href="#cb41-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">1</span>)),</span>
<span id="cb41-446"><a href="#cb41-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">7</span>, <span class="fl">0.5</span>)),</span>
<span id="cb41-447"><a href="#cb41-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">5.5</span>, <span class="dv">2</span>))</span>
<span id="cb41-448"><a href="#cb41-448" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-449"><a href="#cb41-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-450"><a href="#cb41-450" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-451"><a href="#cb41-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj, <span class="at">y =</span> prior)) <span class="sc">+</span> </span>
<span id="cb41-452"><a href="#cb41-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mean_qi, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb41-453"><a href="#cb41-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-454"><a href="#cb41-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"The red lines mark the lower and upper bondaries."</span>,</span>
<span id="cb41-455"><a href="#cb41-455" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])),</span>
<span id="cb41-456"><a href="#cb41-456" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb41-457"><a href="#cb41-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-458"><a href="#cb41-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-459"><a href="#cb41-459" aria-hidden="true" tabindex="-1"></a>Now we update our by-hand prior predictive simulation to accomodate $\beta_0$ and $\beta_1$.</span>
<span id="cb41-460"><a href="#cb41-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-463"><a href="#cb41-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-464"><a href="#cb41-464" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb41-465"><a href="#cb41-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-466"><a href="#cb41-466" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb41-467"><a href="#cb41-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-468"><a href="#cb41-468" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb41-469"><a href="#cb41-469" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta0 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fl">5.5</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb41-470"><a href="#cb41-470" aria-hidden="true" tabindex="-1"></a>       <span class="co"># notice our new line</span></span>
<span id="cb41-471"><a href="#cb41-471" aria-hidden="true" tabindex="-1"></a>       <span class="at">beta1 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb41-472"><a href="#cb41-472" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fu">rexp</span>(<span class="at">n =</span> n, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-473"><a href="#cb41-473" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we have a new expand_grid() line</span></span>
<span id="cb41-474"><a href="#cb41-474" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure everyone understands this coding scheme</span></span>
<span id="cb41-475"><a href="#cb41-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">gendermale =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-476"><a href="#cb41-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">bty_avg =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">13</span>, <span class="at">by =</span> <span class="fl">0.025</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-477"><a href="#cb41-477" aria-hidden="true" tabindex="-1"></a>  <span class="co"># notice the updated mean formula</span></span>
<span id="cb41-478"><a href="#cb41-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> bty_avg, </span>
<span id="cb41-479"><a href="#cb41-479" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> gendermale, </span>
<span id="cb41-480"><a href="#cb41-480" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-481"><a href="#cb41-481" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-482"><a href="#cb41-482" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb41-483"><a href="#cb41-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bty_avg, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb41-484"><a href="#cb41-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-485"><a href="#cb41-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-486"><a href="#cb41-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb41-487"><a href="#cb41-487" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-488"><a href="#cb41-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">"Prior predictive distributions based on "</span><span class="sc">*</span><span class="fu">italic</span>(p)(beta[<span class="dv">0</span>])<span class="sc">~</span> and<span class="sc">~</span><span class="fu">italic</span>(p)(beta[<span class="dv">1</span>])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p)(sigma))) <span class="sc">+</span></span>
<span id="cb41-489"><a href="#cb41-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> gendermale, <span class="at">labeller =</span> label_both)</span>
<span id="cb41-490"><a href="#cb41-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-491"><a href="#cb41-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-492"><a href="#cb41-492" aria-hidden="true" tabindex="-1"></a>Before we fit the model, let's practice the <span class="in">`sample_prior = "only"`</span> approach.</span>
<span id="cb41-493"><a href="#cb41-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-494"><a href="#cb41-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit11.b, results = "hide"}</span></span>
<span id="cb41-495"><a href="#cb41-495" aria-hidden="true" tabindex="-1"></a><span class="in"># check to see if we want to use other priors</span></span>
<span id="cb41-496"><a href="#cb41-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-497"><a href="#cb41-497" aria-hidden="true" tabindex="-1"></a><span class="in">fit11.b = brm(</span></span>
<span id="cb41-498"><a href="#cb41-498" aria-hidden="true" tabindex="-1"></a><span class="in">  data = evals94,</span></span>
<span id="cb41-499"><a href="#cb41-499" aria-hidden="true" tabindex="-1"></a><span class="in">  family = gaussian,</span></span>
<span id="cb41-500"><a href="#cb41-500" aria-hidden="true" tabindex="-1"></a><span class="in">  # notice the 0 + Intercept syntax</span></span>
<span id="cb41-501"><a href="#cb41-501" aria-hidden="true" tabindex="-1"></a><span class="in">  bty_avg ~ 0 + Intercept + gender,</span></span>
<span id="cb41-502"><a href="#cb41-502" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = prior(normal(5.5, 1), class = b, coef = Intercept) +</span></span>
<span id="cb41-503"><a href="#cb41-503" aria-hidden="true" tabindex="-1"></a><span class="in">    prior(normal(0, 1), class = b, coef = gendermale) +</span></span>
<span id="cb41-504"><a href="#cb41-504" aria-hidden="true" tabindex="-1"></a><span class="in">    prior(exponential(1), class = sigma),</span></span>
<span id="cb41-505"><a href="#cb41-505" aria-hidden="true" tabindex="-1"></a><span class="in">  # here's the magic</span></span>
<span id="cb41-506"><a href="#cb41-506" aria-hidden="true" tabindex="-1"></a><span class="in">  sample_prior = "only",</span></span>
<span id="cb41-507"><a href="#cb41-507" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 2</span></span>
<span id="cb41-508"><a href="#cb41-508" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-509"><a href="#cb41-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-510"><a href="#cb41-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-511"><a href="#cb41-511" aria-hidden="true" tabindex="-1"></a>Check the prior summary.</span>
<span id="cb41-512"><a href="#cb41-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-515"><a href="#cb41-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-516"><a href="#cb41-516" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit11.b)</span>
<span id="cb41-517"><a href="#cb41-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-518"><a href="#cb41-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-519"><a href="#cb41-519" aria-hidden="true" tabindex="-1"></a>Compare the prior with the data with <span class="in">`pp_check()`</span>.</span>
<span id="cb41-520"><a href="#cb41-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-523"><a href="#cb41-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-524"><a href="#cb41-524" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb41-525"><a href="#cb41-525" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit11.b, </span>
<span id="cb41-526"><a href="#cb41-526" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"dens_overlay_grouped"</span>,</span>
<span id="cb41-527"><a href="#cb41-527" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">"gender"</span>,</span>
<span id="cb41-528"><a href="#cb41-528" aria-hidden="true" tabindex="-1"></a>         <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb41-529"><a href="#cb41-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb41-530"><a href="#cb41-530" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb41-531"><a href="#cb41-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span>
<span id="cb41-532"><a href="#cb41-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-533"><a href="#cb41-533" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb41-534"><a href="#cb41-534" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit11.b, <span class="at">ndraws =</span> <span class="dv">5</span>,</span>
<span id="cb41-535"><a href="#cb41-535" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"freqpoly_grouped"</span>, <span class="at">group =</span> <span class="st">"gender"</span>) <span class="sc">+</span></span>
<span id="cb41-536"><a href="#cb41-536" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb41-537"><a href="#cb41-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-538"><a href="#cb41-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span>
<span id="cb41-539"><a href="#cb41-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-540"><a href="#cb41-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-541"><a href="#cb41-541" aria-hidden="true" tabindex="-1"></a>There isn't a great grouped histogram option for <span class="in">`pp_check()`</span>, so we experimented with <span class="in">`type = "freqpoly_grouped"`</span> instead.</span>
<span id="cb41-542"><a href="#cb41-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-543"><a href="#cb41-543" aria-hidden="true" tabindex="-1"></a>If we wanted, we could also use the <span class="in">`predict()`</span> function to simulate <span class="in">`bty_avg`</span> values from the priors.</span>
<span id="cb41-544"><a href="#cb41-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-547"><a href="#cb41-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-548"><a href="#cb41-548" aria-hidden="true" tabindex="-1"></a><span class="co"># walk through this slowly</span></span>
<span id="cb41-549"><a href="#cb41-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-550"><a href="#cb41-550" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb41-551"><a href="#cb41-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-552"><a href="#cb41-552" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit11.b,</span>
<span id="cb41-553"><a href="#cb41-553" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb41-554"><a href="#cb41-554" aria-hidden="true" tabindex="-1"></a>        <span class="at">ndraws =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-555"><a href="#cb41-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span>
<span id="cb41-556"><a href="#cb41-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-557"><a href="#cb41-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-560"><a href="#cb41-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-561"><a href="#cb41-561" aria-hidden="true" tabindex="-1"></a><span class="co"># customize the predictor grid, as desired</span></span>
<span id="cb41-562"><a href="#cb41-562" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">gender =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>), <span class="at">each =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-563"><a href="#cb41-563" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this will make it easier to connect the nd data to the predict() output</span></span>
<span id="cb41-564"><a href="#cb41-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb41-565"><a href="#cb41-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-566"><a href="#cb41-566" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb41-567"><a href="#cb41-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-568"><a href="#cb41-568" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit11.b,</span>
<span id="cb41-569"><a href="#cb41-569" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> nd,</span>
<span id="cb41-570"><a href="#cb41-570" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb41-571"><a href="#cb41-571" aria-hidden="true" tabindex="-1"></a>        <span class="at">ndraws =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-572"><a href="#cb41-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-573"><a href="#cb41-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draw =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-574"><a href="#cb41-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>draw) <span class="sc">%&gt;%</span> </span>
<span id="cb41-575"><a href="#cb41-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">str_remove</span>(name, <span class="st">"X"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb41-576"><a href="#cb41-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nd, <span class="at">by =</span> <span class="st">"row"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-577"><a href="#cb41-577" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-578"><a href="#cb41-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb41-579"><a href="#cb41-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">boundary =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-580"><a href="#cb41-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-581"><a href="#cb41-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(draw <span class="sc">~</span> gender, <span class="at">labeller =</span> label_both)</span>
<span id="cb41-582"><a href="#cb41-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-583"><a href="#cb41-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-584"><a href="#cb41-584" aria-hidden="true" tabindex="-1"></a>Once we've settled on our priors, we should once again practice writing out the full model equation:</span>
<span id="cb41-585"><a href="#cb41-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-586"><a href="#cb41-586" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-587"><a href="#cb41-587" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb41-588"><a href="#cb41-588" aria-hidden="true" tabindex="-1"></a>\text{bty_avg}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) <span class="sc">\\</span></span>
<span id="cb41-589"><a href="#cb41-589" aria-hidden="true" tabindex="-1"></a>\mu_i &amp; = \beta_0 + \beta_1 \text{gender}_i <span class="sc">\\</span></span>
<span id="cb41-590"><a href="#cb41-590" aria-hidden="true" tabindex="-1"></a>\beta_0 &amp; \sim \text{Normal}(5.5,1) <span class="sc">\\</span></span>
<span id="cb41-591"><a href="#cb41-591" aria-hidden="true" tabindex="-1"></a>\beta_1 &amp; \sim \text{Normal}(0,1) <span class="sc">\\</span></span>
<span id="cb41-592"><a href="#cb41-592" aria-hidden="true" tabindex="-1"></a>\sigma &amp; \sim \text{Exponential}(1).</span>
<span id="cb41-593"><a href="#cb41-593" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb41-594"><a href="#cb41-594" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-595"><a href="#cb41-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-596"><a href="#cb41-596" aria-hidden="true" tabindex="-1"></a>Okay, let's fit the real model.</span>
<span id="cb41-597"><a href="#cb41-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-598"><a href="#cb41-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit12.b, results = "hide"}</span></span>
<span id="cb41-599"><a href="#cb41-599" aria-hidden="true" tabindex="-1"></a><span class="in"># check to see if we want to use other priors</span></span>
<span id="cb41-600"><a href="#cb41-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-601"><a href="#cb41-601" aria-hidden="true" tabindex="-1"></a><span class="in">fit12.b = brm(</span></span>
<span id="cb41-602"><a href="#cb41-602" aria-hidden="true" tabindex="-1"></a><span class="in">  data = evals94,</span></span>
<span id="cb41-603"><a href="#cb41-603" aria-hidden="true" tabindex="-1"></a><span class="in">  family = gaussian,</span></span>
<span id="cb41-604"><a href="#cb41-604" aria-hidden="true" tabindex="-1"></a><span class="in">  bty_avg ~ 0 + Intercept + gender,</span></span>
<span id="cb41-605"><a href="#cb41-605" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = prior(normal(5.5, 1), class = b, coef = Intercept) +</span></span>
<span id="cb41-606"><a href="#cb41-606" aria-hidden="true" tabindex="-1"></a><span class="in">    prior(normal(0, 1), class = b, coef = gendermale) +</span></span>
<span id="cb41-607"><a href="#cb41-607" aria-hidden="true" tabindex="-1"></a><span class="in">    prior(exponential(1), class = sigma),</span></span>
<span id="cb41-608"><a href="#cb41-608" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb41-609"><a href="#cb41-609" aria-hidden="true" tabindex="-1"></a><span class="in">  # yes, you can set your seed for your posteriors, too</span></span>
<span id="cb41-610"><a href="#cb41-610" aria-hidden="true" tabindex="-1"></a><span class="in">  # this makes the results reproducible</span></span>
<span id="cb41-611"><a href="#cb41-611" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 3</span></span>
<span id="cb41-612"><a href="#cb41-612" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-613"><a href="#cb41-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-614"><a href="#cb41-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-615"><a href="#cb41-615" aria-hidden="true" tabindex="-1"></a>Check the model summary.</span>
<span id="cb41-616"><a href="#cb41-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-619"><a href="#cb41-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-620"><a href="#cb41-620" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit12.b)</span>
<span id="cb41-621"><a href="#cb41-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-622"><a href="#cb41-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-623"><a href="#cb41-623" aria-hidden="true" tabindex="-1"></a>How does the posterior-predictive check look?</span>
<span id="cb41-624"><a href="#cb41-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-627"><a href="#cb41-627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-628"><a href="#cb41-628" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb41-629"><a href="#cb41-629" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit12.b, </span>
<span id="cb41-630"><a href="#cb41-630" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"dens_overlay_grouped"</span>,</span>
<span id="cb41-631"><a href="#cb41-631" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">"gender"</span>,</span>
<span id="cb41-632"><a href="#cb41-632" aria-hidden="true" tabindex="-1"></a>         <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb41-633"><a href="#cb41-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb41-634"><a href="#cb41-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"posterior predictive check"</span>)</span>
<span id="cb41-635"><a href="#cb41-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-636"><a href="#cb41-636" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb41-637"><a href="#cb41-637" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit12.b, <span class="at">ndraws =</span> <span class="dv">5</span>,</span>
<span id="cb41-638"><a href="#cb41-638" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"freqpoly_grouped"</span>, <span class="at">group =</span> <span class="st">"gender"</span>) <span class="sc">+</span></span>
<span id="cb41-639"><a href="#cb41-639" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yes, we can add our red lines to our pp-check</span></span>
<span id="cb41-640"><a href="#cb41-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-641"><a href="#cb41-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"prior predictive check"</span>)</span>
<span id="cb41-642"><a href="#cb41-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-643"><a href="#cb41-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-644"><a href="#cb41-644" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Question 6: Does the posterior predictive check look satsifactory to you?</span></span>
<span id="cb41-645"><a href="#cb41-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-646"><a href="#cb41-646" aria-hidden="true" tabindex="-1"></a>The posterior predictive check look alright. The spread of $y$ for both male and female is quite decently captured by the $y_{rep}$ draws. However, the model still does not respect the upper and lower boundaries sometimes.</span>
<span id="cb41-647"><a href="#cb41-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-648"><a href="#cb41-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-649"><a href="#cb41-649" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb41-650"><a href="#cb41-650" aria-hidden="true" tabindex="-1"></a>For more on prior predictive checks, see McElreath (from Chapter 4), and Solomon Kurz's brms/tidverse implementations as well.</span>
<span id="cb41-651"><a href="#cb41-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-652"><a href="#cb41-652" aria-hidden="true" tabindex="-1"></a>For a comprehensive guide to set priors for a given situation, look at reccomendations made by the Stan team https://github.com/stan-dev/stan/wiki/prior-choice-recommendations</span>
<span id="cb41-653"><a href="#cb41-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-654"><a href="#cb41-654" aria-hidden="true" tabindex="-1"></a>They generally recommend against uniform priors on $\beta$ and $\sigma$ parameters. This is based on a general principle that you should not use a prior that places an artificial boundary on a parameter.</span>
<span id="cb41-655"><a href="#cb41-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-656"><a href="#cb41-656" aria-hidden="true" tabindex="-1"></a>E.g. $\sigma$ parameters have natural lower boundaries at zero, but they don't have upper boundaries. Thus, a uniform prior adds an unnatural upper boundary. A better prior would be something that is weakly informative</span>
<span id="cb41-657"><a href="#cb41-657" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb41-658"><a href="#cb41-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-659"><a href="#cb41-659" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb41-660"><a href="#cb41-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-661"><a href="#cb41-661" aria-hidden="true" tabindex="-1"></a>Hamermesh, D. S., &amp; Parker, A. (2005). Beauty in the classroom: Instructors' pulchritude and putative pedagogical productivity. *Economics of Education Review, 24*(4), 369-376. https://doi.org/10.1016/j.econedurev.2004.07.013</span>
<span id="cb41-662"><a href="#cb41-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-663"><a href="#cb41-663" aria-hidden="true" tabindex="-1"></a>Kurz, A. S. (2023). *Statistical Rethinking with brms, ggplot2, and the tidyverse: Second Edition* (version 0.4.0). https://bookdown.org/content/4857/</span>
<span id="cb41-664"><a href="#cb41-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-665"><a href="#cb41-665" aria-hidden="true" tabindex="-1"></a>McElreath, R. (2020). *Statistical rethinking: A Bayesian course with examples in R and Stan* (Second Edition). CRC Press. https://xcelab.net/rm/statistical-rethinking/</span>
<span id="cb41-666"><a href="#cb41-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-667"><a href="#cb41-667" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session information</span></span>
<span id="cb41-668"><a href="#cb41-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-671"><a href="#cb41-671" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-672"><a href="#cb41-672" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb41-673"><a href="#cb41-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>